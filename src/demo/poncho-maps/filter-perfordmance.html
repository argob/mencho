<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <link 
      rel="stylesheet" 
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
  <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" 
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" />  
  <link 
      rel="stylesheet" 
      href="https://www.argentina.gob.ar/profiles/argentinagobar/themes/contrib/poncho/css/icono-arg.css">
  <!-- /Base -->
  <link rel="stylesheet" href="../../../dist/css/poncho.min.css" />
  <title>Mapa con filtro y buscador</title>
  <style>
    html, body { height: 100%;}
  </style>
</head>
<body class="p-t-3">
  <h1>Template 7</h1>

<!-- 
MAPA CON BUSCADOR FILTRO  

COPIAR DESDE ACÁ…
-->
<div class="col-md-12">
<!-- PONCHO MAP SEARCH -->
<form action="">
  <div data-scope="poncho-map-search">
      <div class="input-group">
          <input 
              type="search" 
              name="search" 
              autocomplete="off"
              class="js-poncho-map-search__input form-control" 
              list="list">
              <datalist id="list" class="js-porcho-map-search__list"></datalist>
          <span class="input-group-btn">
            <button class="js-poncho-map-search__submit btn btn-primary">
              <i class="fa fa-search text-white"> </i>
            </button>
          </span>
      </div>
      <div data-scope="poncho-map" class="m-b-1">
          <div class="js-poncho-map__help small text-default"></div>
      </div>
  </div>
</form>
<!-- / PONCHO MAP SEARCH -->
</div>
<div class="col-md-12">
<!-- PONCHO MAP -->
<div class="poncho-map" data-scope="poncho-map">
    <div
        class="leaflet-container leaflet-touch leaflet-fade-anim 
              leaflet-grab leaflet-touch-drag leaflet-touch-zoom"
        id="map"
        style="height: 600px; width: 100%;"
        tabindex="0">
    </div>
</div>
<!-- / PONCHO MAP -->
</div>

<script 
    src="https://code.jquery.com/jquery-3.6.0.min.js" 
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
    crossorigin="anonymous">
</script>
<script src="../../../src/js/utils.js"></script>
<script src="../../../src/js/poncho-map.js"></script>
<script src="../../../src/js/poncho-map-filter.js"></script>
<script src="../../../src/js/poncho-map-search.js"></script>
<script src="../../../src/js/gapi-sheet-data.js"></script>

<!-- INCLUDE SCRIPTS -->
<script src="https://www.argentina.gob.ar/sites/default/files/ponchotable/showdown.js"></script>
<script src="https://www.argentina.gob.ar/profiles/argentinagobar/themes/argentinagobar/argentinagobar_theme/js/extensiones/showdown-extensions.js"></script>
<script src="https://mapa-ign.argentina.gob.ar/js/leaflet/leaflet.js"></script>
<script src="https://mapa-ign.argentina.gob.ar/js/leaflet/leaflet.markercluster.js"></script>
<link href="https://mapa-ign.argentina.gob.ar/js/leaflet/leaflet.css" rel="stylesheet"/> 
<link href="https://mapa-ign.argentina.gob.ar/js/leaflet/MarkerCluster.css" rel="stylesheet"/> 
<link href="https://mapa-ign.argentina.gob.ar/js/leaflet/MarkerCluster.Default.css" rel="stylesheet"/> 
<!-- <script src="/profiles/argentinagobar/themes/contrib/poncho/js/poncho.min.js"></script> -->
<!-- / INCLUDE SCRIPTS -->

<!-- SCRIPTS -->
<script>

  
  
 // init
 (async() => {
  var start1 = performance.now();
   const data = await fetch_json( "https://144.argentina.gob.ar/api/v1/places" ); 
    // map options
    const options = {
      "latitud": "lat",
      "longitud": "lng",
      "scope": "poncho-map",
      "title": "name",
      "template_markdown": true,
      "header_icons": [
        {
            "key": "phone",
            "css": "icono-arg-telefono-lineal text-primary", 
        },
        {
            "key": "email",
            "css": "icono-arg-mail-1 text-primary", 
        },
        {
            "key": "web",
            "css": "fa fa-link text-primary", 
        },
        {
            "key": "opening_time",
            "css": "icono-arg-reloj text-primary", 
        },
        {
            "key": "observation",
            "css": "fa fa-info-circle text-primary", 
        },
        {
            "key": "ubicacion",
            "css": "icono-arg-marcador-ubicacion-1 text-primary", 
        },
    ],

      "template_structure" : {  
          "values": ["observation", "ubicacion", "phone", "opening_time", "email", "web"],
          "lead": {
            "key": "category",
            "css": "badge bg-primary m-t-0"
          },
          "mixing": [
              // {
              //     "key": "ubicacion",
              //     "header":"Lugar",
              //     "values": ["province", "municipality", "locality"],
              //     "separator": ", "
              // }
              {
                  "key": "ubicacion",
                  "header":"Lugar",
                  "values": ["address", "municipality", "province"],
                  "separator": ", "
              }
          ],
      },
      "headers": {
          "id": "id",
          "name": "Nombre",
          "province": "Provincia",
          "municipality": "Municipio",
          "locality": "Localidad",
          "category": "Tipo",
          "address": "Dirección",
          "phone": "Teléfono del centro",
          "opening_time": "Días y horarios de atención",
          "observation": "Observaciones",
          "lat": "-34.609295",
          "lng": "-58.372318",
          "web": "Sitio web",
          "email": "Correo electrónico"
      },
      "marker" : (self, ele) => (typeof ele.color !== "undefined" && ele.color != "" ? ele.color : "azul"),
      "slider": true,
      "hash": true,
      "filters" :[
          {
            "legend" : "Filtrar por tipo",
            "field": ["category", "checked"],
            "fields": false,
            "check_uncheck_all": true,
          }
      ],
    };
    // render map
    const poncho_filter = new PonchoMapFilter(data.data, options);
    poncho_filter.render();

    // Buscador
    const search_options = {
        "scope": "poncho-map-search", 
        "datalist": false,
        "placeholder": "Buscar centro",
        "search_fields": ["name","province","municipality","category"]
    };
    const search = new PonchoMapSearch(poncho_filter, search_options);
    search.render();
    
     var end1 = performance.now();
  console.log("[PERFORMANCE] TOTAL TIME", (end1 - start1) / 1000 );
  
    
    
  })();
</script><!-- / SCRIPTS -->


</body>
</html>