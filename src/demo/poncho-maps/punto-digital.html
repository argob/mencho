<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script 
      src="https://code.jquery.com/jquery-3.6.0.min.js" 
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
      crossorigin="anonymous">
    </script>
  <link 
      rel="stylesheet" 
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
  <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" 
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" />  
  <link 
      rel="stylesheet" 
      href="https://capacita-back.argentina.gob.ar/profiles/argentinagobar/themes/contrib/poncho/css/icono-arg.css">
  <!-- Dev files -->
 <link rel="stylesheet" href="../../../dist/css/poncho.min.css" /> 

  <title>Mapa Puntos Digitales</title>
  <style>
    @media (prefers-color-scheme:dark) {
      :root {
        --temp :#072538;
        --gray-base: rgba(255,255,255,.8);
      }
      div.poncho-map {
        --slider-background: var(--black);
        --color-base: var(--gray-base);
        --color-primary:var(--cielo) ;
        --active-marker-alpha: 1;
      }
      div.poncho-map *.text-primary { color:var(--celeste-argentina) !important}
      *.text-arandano { color: var(--temp) !important;}
      summary { color:var(--gray-base); }
    }
  </style>
</head>
<body>
<!-- <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> -->
<!-- INCLUDE CSS -->
<link href="https://gis.argentina.gob.ar/js/leaflet/leaflet.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.Default.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.css" rel="stylesheet"/>
<!-- / INCLUDE CSS -->

<!-- INCLUDE SCRIPTS -->
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.js"></script>
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.markercluster.js"></script>

<!-- <script src="../../../dist/js/poncho.min.js"></script> -->
<script src="../../../src/js/poncho-map.js"></script>
<script src="../../../src/js/poncho-map-filter.js"></script>
<script src="../../../src/js/poncho-map-search.js"></script>
<script src="../../../src/js/gapi-sheet-data.js"></script>

<script src="./js/template-punto-digital.js"></script>
<!-- / INCLUDE SCRIPTS -->


<div class="container m-t-2">
  <div class="row">
    <div class="col-md-12 m-b-1">
      <h2 class="h4 text-primary">Punto Digital</h2>


        <form action="">
          <div data-scope="search-efectores">
            <label for="search" class="sr-only">Buscar puntos</label>
            <div class="input-group m-b-0 p-b-0 webform-component">
                <input 
                    spellcheck
                    type="search" 
                    id="search"
                    name="search" 
                    class="js-poncho-map-search__input form-control" 
                    list="js-porcho-map-search__list">
                
                <datalist id="js-porcho-map-search__list"></datalist>
                <span class="input-group-btn">
                  <button 
                      type="submit" 
                      class="js-poncho-map-search__submit btn btn-primary">
                    <span class="sr-only">Buscar término</span>
                    <i class="fa fa-search text-white"></i>
                  </button>
                </span>
            </div>
            
            <div data-scope="ponchomap">
              <div class="js-poncho-map__help text-mutted small"></div>
            </div>
          </div>
        </form>

        
    </div>








    <div class="col-md-12">
<!-- PONCHO MAP -->
<div class="poncho-map" data-scope="ponchomap">
  <div
      class="leaflet-container leaflet-touch leaflet-fade-anim 
            leaflet-grab leaflet-touch-drag leaflet-touch-zoom"
      id="map"
      style="height:600px;width: 100%;"
      tabindex="0">
  </div>
</div>
<!-- / PONCHO MAP -->
</div>

</div>
</div>
<!-- SCRIPTS -->
<script>
  var filter;
  // init
  (async() => {
    // fetch data
    const url = "./data/response.json";
    const sheet_data = await fetch_json(url); 
    const gdata = Object.keys(sheet_data.aPDs).map(e => sheet_data.aPDs[e]).flat();
    // map options
    const options = {
      "template": template_punto_digital,
      // "template": (self, ele) => {
      //     ele.address = [ele.calle, ele.localidad, ele.provincia].filter(e => e).join(", ");
      //     return self.defaultTemplate(self,ele);
      // },
      // "template_header": (self, row) => {
      //   return `<p class="badge bg-cielo m-b-1">Punto digital</p>
      //           <h1 class="h4 text-primary m-t-0">${row.nombre}</h1>`;
      // },
      // "template_structure":{
      //     "title" : "nombre",
      //     "values": ["institucion", "address", "email", "telefono"],
      // },
      // "template_innerhtml":true,
      // "headers" :{
      //     "institucion":"Tipo de institución",
      //     "address":"Dirección",
      //     "email":"Correo electrónico",
      //     "provincia":"Provincia",
      //     "localidad":"Localidad",
      // },
      "title":"nombre",
      "scope":"ponchomap",
      "latitud": "lat",
      "longitud": "long",
      "id": "id_pd",
      "hash": true,
      "slider": true,
      "scroll": true,
      // "marker" : (self, ele) => (typeof ele.color !== "undefined" && ele.color != "" ? ele.color : "azul"),
      "marker": (self, ele) => (ele.hasOwnProperty("estado_funcionamiento") && ele.estado_funcionamiento == "3" ? "mandarina" : "azul"),
      "search_fields": ["nombre", "institucion", "localidad", "provincia", "municipio_nombre"],
      "filters" :[
        {
          "legend" : "Filtrar por estado",
          "type" : "checkbox",
          "fields" : [
              ["estado_funcionamiento", "Abiertos", ["1"], "checked"],
              ["estado_funcionamiento", "Próximamente", ["3"], "checked"],
          ]
        },
        {
          "legend" : "Filtrar por región",
          "type" : "checkbox",
          "fields" : [
              ["provincia", "Buenos Aires y CABA", ["Buenos Aires", "Ciudad Autónoma de Buenos Aires"], "checked"],
              ["provincia", "Noreste Argentino", ["Chaco", "Corrientes", "Formosa", "Misiones"], "checked"],
              ["provincia", "Noroeste Argentino", ["Catamarca", "Jujuy", "La Rioja", "Salta", "Santiago del Estero", "Tucumán"], "checked"],
              ["provincia", "Región Centro", ["Córdoba", "Entre Ríos", "Santa Fe"], "checked"],
              ["provincia", "Región Cuyo", ["La Pampa", "Mendoza", "San Juan", "San Luis"], "checked"],
              ["provincia", "Región Patagonia", ["Chubut", "Neuquén", "Río Negro", "Santa Cruz", "Tierra del Fuego"], "checked"],
          ]
        },
      ],

    };
    // render map
    filter = new PonchoMapFilter(gdata, options);
    filter.render();
    
    // Buscador
    const search_options = {
        "scope": "search-efectores",
        "text": "nombre",
        "id": "id_pd",
        "placeholder": "Buscá tu Punto Digital"
    };
    search = new PonchoMapSearch(filter, search_options);
    search.render();
  })();
</script>
<!-- / SCRIPTS -->
</body>
</html>



