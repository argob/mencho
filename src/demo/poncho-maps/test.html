<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script 
      src="https://code.jquery.com/jquery-3.6.0.min.js" 
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
      crossorigin="anonymous">
    </script>
  <link 
      rel="stylesheet" 
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
  <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" 
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" />  
  <link 
      rel="stylesheet" 
      href="https://capacita-back.argentina.gob.ar/profiles/argentinagobar/themes/contrib/poncho/css/icono-arg.css?rfqjsh">
  <!-- /Base -->
      
      <link rel="stylesheet" href="../../../dist/css/poncho.min.css" />
      <title>Mapa Efectores</title>
    </head>
    <body class="select-component">
	



      
<!-- INCLUDES -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://gis.argentina.gob.ar/js/leaflet/leaflet.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.Default.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.css" rel="stylesheet"/>
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.js"></script>
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.markercluster.js"></script>


<script src="../../../src/js/poncho-map.js"></script>
<script src="../../../src/js/poncho-map-filter.js"></script>
<script src="../../../src/js/poncho-map-search.js"></script>
<script src="../../../src/js/gapi-sheet-data.js"></script>
<!-- <script src="/profiles/argentinagobar/themes/contrib/poncho/js/poncho.min.js"></script> -->
<!-- / INCLUDE SCRIPTS -->

      <div class="col-md-12 m-y-1">
        <!-- PONCHO MAP SEARCH -->
        <form action="">
          <div data-scope="search">

            <div class="form-group m-b-2 webform-component">
            <select class="form-control poncho-map-search js-poncho-map-search__select2" name="search">
            </select>
            </div>
            
          
            <div data-scope="poncho-map">
              <div class="js-poncho-map__help" style="color:var(--default, gray)"></div>
            </div>
          </div>
        </form>
        <!-- / PONCHO MAP SEARCH -->
      </div>
      <div class="col-md-12">
        <!-- poncho map -->
        <div class="poncho-map" data-scope="poncho-map">
          <!-- leaflet -->
          <div
              class="leaflet-container leaflet-touch leaflet-fade-anim 
                    leaflet-grab leaflet-touch-drag leaflet-touch-zoom"
              id="map"
              style="height:700px;width: 100%;"
              tabindex="0">
          </div>
          <!-- / leaflet -->
        </div>
        <!-- / poncho map -->







<!-- SCRIPTS -->
<script>
  let filter;
  // init
  const _url = 'https://capacita-back.argentina.gob.ar/sites/default/files/puntos_digitales.json';
  const url = 'https://servicios.puntodigital.paisdigital.modernizacion.gob.ar/ws/ws-eventos.php?method=getPDs';
  // const url = "./data/response.json";

  jQuery.getJSON(url, function(sheet_data) {
    // FETCH DATA
    // const sheet_data = await fetch_json(url); 
    const gdata = Object.keys(sheet_data.aPDs).map(e => sheet_data.aPDs[e]).flat();
    
    // MAPA
    const options = {
      "template": template_punto_digital,
      "scope": "poncho-map",
      "id": "id_pd",
      "latitud": "lat",
      "longitud": "long",
      "hash": true,
      "slider": true,
      "scroll": true,
      "marker": "cielo",
      "reset_zoom": true,
      "filters": [
        {
          "legend": "Filtrar por región",
          "type": "checkbox",
          "fields": [
              ["provincia", "Buenos Aires y CABA", ["Buenos Aires", "Ciudad Autónoma de Buenos Aires"], "checked"],
              ["provincia", "Noreste Argentino", ["Chaco", "Corrientes", "Formosa", "Misiones"], "checked"],
              ["provincia", "Noroeste Argentino", ["Catamarca", "Jujuy", "La Rioja", "Salta", "Santiago del Estero", "Tucumán"], "checked"],
              ["provincia", "Región Centro", ["Córdoba", "Entre Ríos", "Santa Fe"], "checked"],
              ["provincia", "Región Cuyo", ["La Pampa", "Mendoza", "San Juan", "San Luis"], "checked"],
              ["provincia", "Región Patagonia", ["Chubut", "Neuquén", "Río Negro", "Santa Cruz", "Tierra del Fuego"], "checked"],
          ]
        },
      ],
      "marker_cluster_options": {
          "spiderfyOnMaxZoom": true,
          "showCoverageOnHover": false,
          "zoomToBoundsOnClick": true,
          "maxClusterRadius": 45,
        }
    };
    filter = new PonchoMap(gdata, options);
    filter.render();
    
    // BUSCADOR DE MARKERS
    const search_options = {
      "scope": "search",
      "text": "nombre",
      "id": "id_pd",
      "placeholder": "Buscá tu Punto Digital",
      "template": (self, entry) => {
          return "<dl class=\"p-b-0 m-y-0\">" 
              + "<dt>" + entry.nombre + "</dt>"
              + "<dd class=\"m-b-0 small\">" 
              + entry.provincia + ", " + entry.localidad 
              + "</dd></dl>";
      },
      "search_fields": [
          "nombre",
          "institucion",
          "localidad",
          "provincia",
          "municipio_nombre"
      ]
    };
    search = new PonchoMapSearch(filter, search_options);
    search.render();
  });
</script>
<!-- / SCRIPTS -->
<!-- TEMPLATE -->
<script>
  const template_punto_digital=(n,t)=>{const a=["domingo","lunes","martes","miércoles","jueves","viernes","sábado","domingo"],e=n=>n.map((n=>`de ${n.map((n=>(n=>{const t=new Date(`May 09 2012 ${n}`);return`${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}`})(n))).join(" a ")}`)).join(" y "),i=(new Date).getDay(),s=(n=>{if(!n)return[];const t=new Map;for(const e of n.split(" <>")){const n=e.split(","),i=[a[n[0]],[n[1],n[2]]];t.has(i[0])?t.set(i[0],[i[1],...t.get(i[0])]):t.set(i[0],[i[1]])}return Array.from(t).map((n=>[n[0],n[1].reverse()]))})(t.horario),o=s.find((n=>n[0]==a[i]));let r=s.map((n=>{const t=n[0]==a[i]?"text-arandano":"";let s=e(n[1]);return`<li class="${t}"><strong>${n[0]}</strong>: ${s} h.</li>`})).join("");if(r){let n=!1;o&&(n=`<dd class="text-arandano" style="font-weight:bold; margin-bottom:0">\n              <i class="icono-arg-reloj text-arandano"></i>\n              Hoy abierto\n          </dd> \n          <dd class="m-l-2 text-arandano">${e(o[1])} h.\n          </dd>`),r=`<dt class="sr-only">\n        <i class="icono-arg-reloj text-primary"></i> \n        Horarios\n      </dt>\n      ${n||""}\n      <dd class="_m-l-2">\n        <details style="font-size:.93em" close>\n        <summary class="p-b-0 p-t-0">Horarios de atención</summary>\n        <ul class="list-unstyled m-t-0">${r}</ul>\n        </details>\n      </dd>`}let l=`<dt class="sr-only">Tipo de institución</dt>\n      <dd class="_m-l-2">\n        <i class="icono-arg-institucion  text-primary"></i> \n        <b>${t.institucion}</b>\n      </dd>`,d=`<dt>\n          <i class="icono-arg-telefono-lineal text-primary"></i> \n          Teléfono del centro\n      </dt>\n      <dd class="m-l-2">${t.telefono}</dd>`,c=`<dt>\n          <i class="icono-arg-mail-1 text-primary"></i> Correo electrónico\n      </dt>\n      <dd class="m-l-2">${t.email}</dd>`,m=`<dt><i class="fa fa-link text-primary"></i> Página web</dt>\n      <dd class="m-l-2">\n        <a href="${t.facebook}" target="_blank">${t.facebook}</a>\n      </dd>`;return`<article>\n        <h1 class="h4 text-primary p-t-0 m-t-0">${t.nombre}</h1>\n        ${"3"==t.estado_funcionamiento?'<div class="alert alert-warning" style="padding:.5em .75em;">\n        <p class="text-mandarina">\n          <strong>Próximamente</strong>\n        </p>\n      </div>':""}\n        <dl style="font-size:1rem">\n          ${l}\n          <dt>\n            <i class="icono-arg-marcador-ubicacion-1 text-primary" \n                style="padding-right:.25rem;"></i> \n            Ubicación\n          </dt>\n          <dd class="m-l-2 m-b-0">\n          ${t.calle}.\n          </dd>\n          <dd class="m-l-2">\n            ${[t.municipio_nombre,t.provincia].join(", ")}.\n          </dd>\n          ${r}\n          ${t.telefono?d:""}\n          ${t.email?c:""}\n          ${t.facebook?m:""}\n        </dl>\n      </article>`};
</script>
<!-- /TEMPLATE -->

</body>
</html>