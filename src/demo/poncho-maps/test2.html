<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <script 
      src="https://code.jquery.com/jquery-3.6.0.min.js" 
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
      crossorigin="anonymous">
    </script>
  <link 
      rel="stylesheet" 
      href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
  <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" 
      integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" />  
  <link 
      rel="stylesheet" 
      href="https://capacita-back.argentina.gob.ar/profiles/argentinagobar/themes/contrib/poncho/css/icono-arg.css?rfqjsh">
  <!-- /Base -->
  <link rel="stylesheet" href="../../../dist/css/poncho.min.css" />
  <title>Mapa con filtro y buscador</title>
</head>
<body class="select-component">

  <style>
    button[aria-expanded="true"] {
        background-color: #0072bb !important; color:white !important;
    }
  </style>

<!-- 
MAPA CON BUSCADOR FILTRO  
-->
<div class="container">
  <div class="row">

<div class="col-md-12">
<!-- PONCHO MAP SEARCH -->
<form action="" id="poncho-map-search">
    <div data-scope="poncho-map-search">
        <div class="input-group">
            <input 
                type="search" 
                id="search"
                name="search" 
                class="js-poncho-map-search__input form-control" 
                list="js-porcho-map-search__list">
            <datalist id="js-porcho-map-search__list" spellcheck="false"></datalist>
            <span class="input-group-btn">
              <button class="js-poncho-map-search__submit btn btn-primary">
                  <i class="fa fa-search text-white"></i>
              </button>
            </span>
        </div>
        <div data-scope="poncho-map" class="m-b-1">
            <div class="js-poncho-map__help small text-default"></div>
        </div>
    </div>
</form>
<!-- / PONCHO MAP SEARCH -->
</div>
<div class="col-md-12">
<!-- PONCHO MAP -->
<div class="poncho-map" data-scope="poncho-map">
    <div
        class="leaflet-container leaflet-touch leaflet-fade-anim 
              leaflet-grab leaflet-touch-drag leaflet-touch-zoom"
        id="map"
        style="height: 600px; width: 100%;"
        tabindex="0">
    </div>
</div>
<!-- / PONCHO MAP -->
</div>


</div>
</div>

<script src="../../../src/js/poncho-map.js"></script>
<script src="../../../src/js/poncho-map-filter.js"></script>
<script src="../../../src/js/poncho-map-search.js"></script>
<script src="../../../src/js/gapi-sheet-data.js"></script>

<!-- INCLUDE SCRIPTS -->
<script src="https://www.argentina.gob.ar/sites/default/files/ponchotable/showdown.js"></script>
<script src="https://www.argentina.gob.ar/profiles/argentinagobar/themes/argentinagobar/argentinagobar_theme/js/extensiones/showdown-extensions.js"></script>

<link href="https://gis.argentina.gob.ar/js/leaflet/leaflet.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.Default.css" rel="stylesheet"/>
<link href="https://gis.argentina.gob.ar/js/leaflet/MarkerCluster.css" rel="stylesheet"/> 
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.js"></script>
<script src="https://gis.argentina.gob.ar/js/leaflet/leaflet.markercluster.js"></script>
<script src="/profiles/argentinagobar/themes/contrib/poncho/js/poncho.min.js"></script>
<!-- / INCLUDE SCRIPTS -->


<style>
    #js-anchor-slider--poncho-map {
        position: absolute; left: 10px; top: 10px;
        border-radius: 50%;
        display: block;
        width: 9px;
        outline: none;
        height: 9px;
        border:none;
        background-color: transparent;
        transition:.3s;
    }
    #js-anchor-slider--poncho-map:focus {
    background: rgb(205, 220, 57);
    box-shadow: 0 0 6px rgba(205, 220, 57, .5);
    color:white;
  }
  #js-anchor-slider--poncho-map:blur {
    background: dodgerblue;
    color:white;
  }
</style>
<!-- SCRIPTS -->
<script>
  // init
  (async() => {
    // GApi helpers
    const gapi = new GapiSheetData({"gapi_key": "AIzaSyCq2wEEKL9-6RmX-TkW23qJsrmnFHFf5tY"});
    // fetch data
    // const googlesheet_data = await fetch_json(gapi.url("[nombre pagina google sheet]", "[id google sheet]")); 
    const googlesheet_data = await fetch_json( gapi.url("dataset", "1odAYQJJtl53_6jbgew3ueGwAanU4SkofmlxoTsfPK4o") ); 
    const gapi_data = gapi.json_data(googlesheet_data);
    // map options
    const options = {
      "template_title_class_list":["h4","text-cielo","m-t-0"],
      // El programa asume que los valores de latitud y longitud se 
      // obtienen de columnas con esos mismos nombres. Si no fuera ese
      // el caso, se debe especificar el nombre. 
      //     "latidud": "lat",
      //     "longitud": "lon",
      // Ámbito/alcance del componente. Cambiar acá y en el html solo 
      // si hay más de un mapa.
      "scope": "poncho-map",
      // El id se utiliza para identificar un marcador con una entrada.
      // El programa usa el nombre «id» por defecto, si la columna tuviera
      // otro nombre se debe reemplazar. 
      //     Si el documento no necesita o no tiene un ID el programa 
      // lo genera automáticamente para identificar el marker.
      //     "id" : "id_con_otro_nombre",
      // Nombre que se utiliza como título por defecto para los markers.
      // También es importante para mejorar aspectos de accesibilidad.
      "title": "ente-ejecutor",
      // Si se neceista usar markdown en los valores se activa con (true).
      // Por defecto viene en (false). Incluye algunas extensiones Poncho.
      "template_markdown": true,
      // Define la estructura básica para el popUp o slider.
      "template_structure" : {
          // Defino los valores que deseo mostrar o excluyo los que 
          // están de más. El uso depende de la practicidad.
          "values": [
              "ente-ejecutor", "Ubicación", "modalidad-gestion",
              "estado-obra", "n-proyecto", "lotes-generados",
              "expediente-origen", "inversion-total","inversion-lote"
          ],
          //     "exclude": ["id", "inhibicion_puberal", "hormonizacion_adolescentes"]
          // Con mixing puedo armar grupo de columnas separadas con 
          // un caracter. El key, sea uno inventado o uno que forma 
          // parte del JSON, debo agregarlo en «values».
          "mixing": [
              {
                  "key": "Ubicación",
                  "values": ["localidad", "provincia"],
                  "separator": ", "
              }
          ],
      },
      // Define los headers. En este caso usa los definidos el la 
      // fila 2 del GoogleSheet.
      "headers": gapi_data.headers,
      // Define el color del marker. En este caso, si existe la columna 
      // «color» y ésta tiene definido un nombre de color Poncho*, 
      // reemplaza el color del marker. También se puede usar "marker":"azul".
      "marker" : (self, ele) => (typeof ele.color !== "undefined" && ele.color != "" ? ele.color : "azul"),
      // Slider con información. Sin ésta opción o con su valor en (false)
      // reemplaza el PopUp por un slider.
      "slider": true, // Activo/Inactivo
      // Imprime el identificador de la entrada la barra de url.
      "hash": true, // Activo/Inactivo
      // Cuando se accede por primera vez a la página y en la dirección
      // hay un hash con id, la página hace scroll hasta llegar a la
      // ubicación del mapa.
      //    "scroll": true, // Activo/Inactivo
      // Grupos de filtros.
      "filters" :[
        {
          // Lenged para el fileset
          "legend" : "Estado de obra",
          "fields" : [
              // [nombre de columna, titulo para el checkbox, valores a buscar en la columna ej: ["A", "B"], "checked" o false]
              ["estado-obra", "En ejecución", ["En ejecución"], "checked"],
              ["estado-obra", "A ejecutarse", ["A ejecutarse"], "checked"],
          ]
        },
        {
          // Lenged para el fileset
          "legend" : "Modalidad",
          "fields" : [
              // [nombre de columna, titulo para el checkbox, valores a buscar en la columna ej: ["A", "B"], "checked" o false]
              ["modalidad-gestion", "Administración", ["Administración"], "checked"],
              ["modalidad-gestion", "Licitación", ["Licitación"], "checked"],
              ["modalidad-gestion", "No informa", ["No informa"], "checked"],
              ["modalidad-gestion", "Compra de suelo", ["Compra de Suelo"], "checked"],
          ]
        },
      ]
    };
   
    // render map
    const poncho_filter = new PonchoMapFilter(gapi_data.entries, options);
    poncho_filter.render();

    // Buscador
    const search_options = {
        // Ámbito/alcance del componente. Cambiar solo si hay dos mapas.
        "scope": "poncho-map-search", 
        // Placeholder del campo de formulario «search»
        "placeholder": "Buscar ente ejecutor",
        // Columnas donde debe buscar un término.
        "search_fields": ["localidad", "provincia", "ente-ejecutor"] 
    };
    const search = new PonchoMapSearch(poncho_filter, search_options);
    search.render();
  })();
</script>
<!-- / SCRIPTS -->


</body>
</html>